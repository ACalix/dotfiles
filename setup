#!/bin/bash
set -eo pipefail

readonly TMP_DIR=$(mktemp -d)
readonly CONFIGS=".zshrc
  .Xresources
  .vimrc
  .tmux.conf
  .vim
  .zsh"


copy_to_backup() {
  mv "${HOME}/${1}" "${TMP_DIR}/${1}"
}


backup_configs() {
  local backup_required=false

  for config in $(echo "$CONFIGS"); do
    local path="${HOME}/${config}"
    if [[ -f "$path" ]] || [[ -d "$path" ]]; then
      copy_to_backup "$config"
      backup_required=true
    fi
  done

  if [[ backup_required ]]; then
    echo "Created a backup at ${TMP_DIR}"
  else
    rm -rf "$TMPDIR"
  fi
}

link_configs() {
  ln -s $PWD/zshrc $HOME/.zshrc
  ln -s $PWD/rxvt/Xresources.xoria $HOME/.Xresources
  ln -s $PWD/vim/vimrc $HOME/.vimrc
  ln -s $PWD/tmux.conf $HOME/.tmux.conf
  ln -s $PWD/vim $HOME/.vim
  ln -s $PWD/zsh $HOME/.zsh
}


main() {
  backup_configs
  link_configs

  exit 0
}

main
